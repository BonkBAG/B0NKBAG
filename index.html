<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BONK BAG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
      background: url('background.png') no-repeat center center fixed;
      background-size: cover;
      color: white;
      height: 100vh;
      overflow-x: hidden;
    }
    .section {
      display: none;
      position: absolute;
      top: 120px;
      left: 0;
      right: 0;
      margin: auto;
      max-width: 800px;
      background-color: rgba(0, 0, 0, 0.6);
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
    }
    #stakeAmount {
      padding: 6px;
      border-radius: 4px;
      margin: 10px 0;
    }
    #stakeRange {
      width: 100%;
    }
    #balance-display {
      font-weight: bold;
      color: #00e676;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
<div id="staking-section" class="section">
  <h2>Staking</h2>
  <div id="balance-display">BAG Balance: 0</div>
  <input type="range" id="stakeRange" min="0" max="100" value="0" oninput="updateStakeAmount(this.value)" />
  <p id="range-value">Selected: 0%</p>
  <input type="number" id="stakeAmount" placeholder="Amount to stake" />
  <br><br>
  <button onclick="approveTokens()">Approve</button>
  <button onclick="stakeTokens()">Stake</button>
  <br><br>
  <div id="stake-status" style="color: #66ff66;"></div>
  <br><button onclick="resetView()" style="background:#00c853;color:white;padding:10px 20px;border:none;border-radius:8px;">Back</button>
</div>
<script>
  let bagBalance = 0;

  function updateStakeAmount(percent) {
    document.getElementById('range-value').innerText = "Selected: " + percent + "%";
    const stakeAmount = ((bagBalance * percent) / 100).toFixed(4);
    document.getElementById('stakeAmount').value = stakeAmount;
  }

  async function loadBagBalance(web3, address) {
    const contract = new web3.eth.Contract([
      { constant: true, inputs: [{ name: "_owner", type: "address" }], name: "balanceOf", outputs: [{ name: "balance", type: "uint256" }], type: "function" }
    ], "0x3686568eCB6cE7545765b641932044900d11e584");
    const balance = await contract.methods.balanceOf(address).call();
    bagBalance = balance / (10 ** 18);
    document.getElementById("balance-display").innerText = "BAG Balance: " + bagBalance.toFixed(4);
  }
</script>
</body>
</html><script>
  let web3;
  let currentAccount;
  const bagTokenAddress = "0x3686568eCB6cE7545765b641932044900d11e584";
  const stakingContractAddress = "0x2FD42050700A491321919a4872490DD621Bbb6F5";

  const erc20Abi = [
    { constant: true, inputs: [{ name: "_owner", type: "address" }], name: "balanceOf", outputs: [{ name: "balance", type: "uint256" }], type: "function" },
    { constant: false, inputs: [{ name: "spender", type: "address" }, { name: "value", type: "uint256" }], name: "approve", outputs: [{ name: "", type: "bool" }], type: "function" }
  ];
  const stakingAbi = [
    { inputs: [{ internalType: "uint256", name: "amount", type: "uint256" }, { internalType: "uint8", name: "monthsLock", type: "uint8" }], name: "stake", outputs: [], stateMutability: "nonpayable", type: "function" }
  ];

  async function connectWeb3() {
    if (typeof window.ethereum !== 'undefined') {
      web3 = new Web3(window.ethereum);
      const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
      currentAccount = accounts[0];
      await loadBagBalance(web3, currentAccount);
    } else {
      alert("Please install MetaMask.");
    }
  }

  async function approveTokens() {
    const amount = document.getElementById("stakeAmount").value;
    const contract = new web3.eth.Contract(erc20Abi, bagTokenAddress);
    const amountInWei = web3.utils.toWei(amount, 'ether');
    contract.methods.approve(stakingContractAddress, amountInWei).send({ from: currentAccount })
      .then(() => document.getElementById("stake-status").innerText = "Approved successfully")
      .catch(err => document.getElementById("stake-status").innerText = "Approval failed: " + err.message);
  }

  async function stakeTokens() {
    const amount = document.getElementById("stakeAmount").value;
    const lockPeriod = 3; // можна зробити динамічно
    const contract = new web3.eth.Contract(stakingAbi, stakingContractAddress);
    const amountInWei = web3.utils.toWei(amount, 'ether');
    contract.methods.stake(amountInWei, lockPeriod).send({ from: currentAccount })
      .then(() => document.getElementById("stake-status").innerText = "Staked successfully")
      .catch(err => document.getElementById("stake-status").innerText = "Staking failed: " + err.message);
  }

  window.addEventListener("load", async () => {
    await connectWeb3();
  });
</script>
